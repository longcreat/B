### **多层级分销价盘与分账结算系统 - PRD**

| **文档版本** | **关联版本** | **修订日期** | **修订人** | **修订内容** |
| :--- | :--- | :- | :--- | :--- |
| V1.0 | V1.0 PRD | 2025-10-30 | [您的名字] | 初稿创建：价盘、分账及创新结算 |

#### **1.0 核心概念与定价模型**
##### **1.1 价格体系定义**
1.  **P0 - 供应商底价:**
    *   **定义：** 我们从上游酒店资源商获取的、不含任何利润的裸仕价。
    *   **来源：** 上游供应商API。
2.  **P1 - 平台供货价:**
    *   **定义：** 我们加上自己的平台利润后，准备供给小B的“批发价”。
    *   **计算公式：** `P1 = P0 * (1 + 平台利润率)`
    *   **管理者：** 由我方运营人员在后台配置`平台利润率`。

3.  **P2 - 小B销售价:**
    *   **定义：** 小B在其渠道（如SaaS网站）上，最终呈现给C端用户的销售价格。
    *   **计算公式：** `P2 = P1 * (1 + 小B加价率)`
    *   **管理者：** 由小B分销商在其后台配置`小B加价率`。

##### **1.2 利润归属定义**
基于以上价格体系，每一笔成功订单的利润归属如下：

1.  **我方平台利润:**
    *   **计算公式：** `平台利润 = P1 - P0`

2.  **小B分销商利润:**
    *   **计算公式：** `小B利润 = P2 - P1`

#### **2.0 分账与结算逻辑**

##### **2.1 资金清分模型**
对于每一笔由我方平台统一收取的`P2`金额，系统在后台进行逻辑清分：

*   **应付供应商成本:** 金额为 `P0`。
*   **应付小B利润:** 金额为 `小B利润`。
*   **我方平台留存:** 金额为 `平台利润`。
*   **校验公式：** `P2 = P0 + 小B利润 + 平台利润` 必须恒等。

##### **2.2 结算触发条件**

###### **FRD-FIN-201: 订单可结算状态 (Billable Status) 的判定**

订单进入可结算状态，必须同时满足以下所有条件。这是一个**多重门控 (Multi-Gate)** 的逻辑，确保只有干净、无争议的订单才能进入结算流程。

*   **Gate 1: 服务已完成 (Service Rendered)**
    *   **核心标准：** C端客人的**离店日期 (Check-out Date)** 已过。
    *   **系统逻辑：** 每日凌晨，系统自动扫描所有订单，将 `离店日期 < T(今日)` 的订单标记为“服务已完成”。
    *   **为什么是离店日期？** 这是酒店行业公认的服务终结点。以此为准，可以避免因客人在入住期间产生的任何变动（如提前离店、续住）导致的计算错误。

*   **Gate 2: 冻结期已过 (Cooling-off Period Passed)**
    *   **核心标准：** 订单已安全度过内部设定的`结算冻结期`。
    *   **计算公式：** `T(今日) - 离店日期 > 结算冻结期天数`
    *   **冻结期设定 (后台可配置)：** 建议设置为 **7-15天**。
    *   **为什么需要冻结期？**
        1.  **处理客诉与账务调整 (Chargeback & Adjustment):** 这是处理客人离店后可能出现的投诉（如房间设施问题、额外消费争议）的缓冲期。财务团队可能需要在此期间调整订单的最终结算金额。
        2.  **应对No-Show罚金争议：** 客人未入住（No-Show）通常会产生罚金，但客人可能会申诉（如航班取消、急病）。冻结期为处理这类争议提供了时间。
        3.  **防范欺诈风险：** 特别是针对盗刷信用卡的欺诈行为，冻结期可以增加欺诈行为被发现和拦截的时间窗口。

*   **Gate 3: 订单无未决争议 (No Pending Disputes)**
    *   **核心标准：** 订单在系统中没有被标记为 `争议中`、`退款处理中` 或 `待核查` 等任何异常状态。
    *   **系统逻辑：** 这是一个状态锁。只要订单被客服或财务人员挂起了任何异常状态，就无法通过此门控，直到该状态被解决。
*   **Gate 4: 供应商成本已对账 (Supplier Cost Reconciled)**
    *   **FRD-FIN-203: 引入对账状态**
    *   **核心标准：** 订单的`P0 - 供应商底价`已经与上游供应商的账单进行过核对并确认无误。
    *   **为什么这是绝对必要的？**
        *   在酒店分销中，API返回的实时底价与供应商最终结算的月度账单价，可能因各种原因（系统误差、临时调价、附加费等）存在**微小差异**。
        *   **如果我们在对账前，就按系统记录的P0向下游小B结算了利润，一旦上游的实际成本更高，这部分损失将由我方平台承担。**
    *   **系统逻辑：**
        1.  每笔订单新增一个**`对账状态`**，默认为`未对账`。
        2.  财务人员在收到上游供应商的月度账单后，在后台进行**对账操作**。可以批量导入账单，由系统自动比对，也可以手动核对。
        3.  只有当一笔订单的`对账状态`被更新为`已对账`后，它才能通过Gate 4。
    *   **这意味着：** 订单的**可结算**，不仅取决于它自身的状态，还取决于其**成本的确定性**。

*   **Gate 5: 结算对象状态正常 (Partner Account Health)**
    *   **FRD-FIN-204: 引入结算对象健康状态**
    *   **核心标准：** 该小B分销商/供应商的账户本身处于`活跃`或`可结算`状态。
    *   **为什么？**
        *   分销商可能因违规操作被**临时冻结 (On-Hold)**。
        *   分销商可能正在进行法人变更或账户信息更新，此时应**暂停结算**以避免支付错误。
        *   分销商的合同可能已到期但未续约。
    *   **系统逻辑：**
        1.  在每个小B客户/供应商的档案中，增加一个**`结算状态`**字段（`活跃`, `冻结`, `已关闭`）。
        2.  结算引擎在为某个伙伴生成结算批次前，**必须先检查其账户的`结算状态`**。如果状态非`活跃`，则该伙伴本周期的所有可结算订单将被自动顺延至下一周期，直到其账户状态恢复正常。

*   **Gate 6: 达到最低起付金额 (Minimum Payout Threshold)**
    *   **FRD-FIN-205: 引入起付线规则**
    *   **核心标准：** 本周期内，该结算对象的**累计可结算利润/成本**达到了平台设定的最低起付金额。
    *   **后台可配置：** 例如，对小B的最低起付金额为 **¥100.00**。
    *   **为什么？**
        *   **降低操作成本：** 避免为几元甚至几毛钱的利润发起一次银行转账或采购一次京东卡，这会产生不必要的财务和人力成本。
        *   **简化账务：** 减少小额、零碎的结算批次数量，让账务更加清晰。
    *   **系统逻辑：**
        1.  结算引擎在聚合完一个伙伴所有满足前5个门控的订单后，会计算出本周期的**应结总额**。
        2.  **IF** `应结总额 >= 最低起付金额` **THEN** -> 生成结算批次。
        3.  **IF** `应结总额 < 最低起付金额` **THEN** -> **不生成结算批次**，该金额将自动**滚存 (Roll-over)** 到下一结算周期，与下一周期的金额累加计算。

###### **FRD-FIN-202: 结算批次生成**
    *   **触发时机：** 每周一凌晨（或后台设定的任何周期性时间点）。
    *   **动作：** 系统扫描所有**同时满足 Gate 1, 2, 3** 的订单，将它们聚合起来，按照不同的结算对象（小B、供应商）生成待处理的结算批次。

##### **2.3 复杂情景处理 (酒店行业深度场景分析)**

###### **场景一：提前离店 (Early Check-out)**
*   **情景描述：** 客人预订了3晚，但只住了2晚就提前离店。
*   **处理逻辑：**
    1.  **数据来源：** 依赖上游供应商API能否准确返回或由酒店PMS系统通知最终的实际入住晚数和应结算的`P0 - 供应商底价`。
    2.  **财务影响：**
        *   `P0` 将会更新为2晚的底价。
        *   `P2 - 小B销售价` 可能需要调整。这取决于预订时的取消政策（例如，提前离店是否产生罚金）。
    3.  **PRD要求：**
        *   订单系统必须能够接收和处理来自上游的“**账单调整通知**”。
        *   收到通知后，该订单应被**自动标记为`待核查`**，并通知我方运营人员。
        *   运营人员需根据预订政策，与小B沟通确认最终的对客售价`P2`，并在后台更新订单的最终财务数据后，才能解除`待核查`状态。

###### **场景二：续住 (Extend Stay)**
*   **情景描述：** 客人入住后决定多住1晚。
*   **处理逻辑：**
    1.  **最佳实践：** 财务上严格遵循“**原订单不变，续住部分下新单**”的原则。
    2.  **为什么？** 续住的1晚，其`P0 - 供应商底价`可能与原订单不同（受实时房价影响）。将其作为独立的新订单，可以确保每笔账务的清晰和准确。
    3.  **PRD要求：**
        *   小B后台或我方运营后台应支持为现有入住单“**关联续住单**”的功能。
        *   续住单在财务上是完全独立的，有自己的订单号和结算周期。

###### **场景三：未入住 (No-Show)**
*   **情景描述：** 客人预订了但最终没有出现。通常会产生首晚房费作为罚金。
*   **处理逻辑：**
    1.  上游供应商会将该订单的`P0 - 供应商底价`更新为罚金金额（通常是首晚底价）。
    2.  我方平台统一向C端用户收取`P2 - 小B销售价`的首晚罚金。
    3.  **利润分配：**
        *   `平台利润 = (P1首晚价) - (P0首晚底价)`
        *   `小B利润 = (P2首晚售价) - (P1首晚价)`
    4.  **PRD要求：** 订单系统需能正确处理和记录No-Show状态，并根据罚金金额重新计算各方利润。该订单同样需要经过`结算冻结期`，以应对潜在的客人申诉。

###### **场景四：升房/降房及其他现场消费**
*   **情景描述：** 客人在酒店前台进行了升房、预订了早餐、使用了minibar等。
*   **处理原则：** **严格分离预付房费和到店消费。**
*   **逻辑：**
    1.  我们的结算系统**只处理线上预付的房费部分**。
    2.  所有在酒店前台发生的额外消费，均由客人与酒店直接结算，**不进入我们的分账体系**。
*   **PRD要求：**
    *   在小B的预订页面和订单确认信中，必须有明确的条款说明：“**本订单费用仅包含房费及税费，任何在酒店产生的额外消费需由您直接与酒店结算。**”
    *   这能有效规避因信息不透明导致的后期财务纠纷。

#### **3.0 小B客户税务与创新结算方案**
##### **3.1 核心问题**
直接向个人类型的小B支付现金“利润”，会使其面临较高的个人劳务所得税，且我方平台也存在合规风险。
##### **3.2 解决方案：利润虚拟资产化**
*   **FRD-FIN-301: 建立虚拟账户体系**
    *   每个小B客户在平台内都拥有一个**利润账户**。
    *   所有`应付小B利润`在结算周期触发时，**不直接生成待付现金账单**，而是以“积分”或“余额”的形式，计入其平台的虚拟利润账户。
    *   **例如：** 某小B本周有1000元利润可结算，其后台利润账户余额增加 1000.00。
*   **FRD-FIN-302: 利润提取商城**
    *   小B客户可以在其后台，使用其“利润账户”的余额，在一个专门的“兑换商城”中进行消费。
    *   **商城提供的“商品”即为利润提取方式**，每种方式对应不同的成本和规则。
##### **3.3 利润提取方式设计**
*   **A. 现金提取 (T+1结算)**
    *   **产品形态：** 商城中的“现金提现”商品。
    *   **兑换逻辑：**
        *   小B申请提取1000元利润。
        *   系统**自动计算并代扣代缴个人所得税**。税率根据国家税务法规，按“个人劳务报酬所得”或与税务机构协商的更优方案计算。
        *   **公式：** `实际到账金额 = 提取金额 - 应缴税额`
        *   平台将`实际到账金额`支付到小B认证的银行卡。
    *   **优势：** 完全合规。
    *   **劣势：** 税负较高，小B实际所得可能打折。
*   **B. 京东E卡/电商卡兑换**
    *   **产品形态：** 商城中的“京东E卡”商品，有不同面额可选（如100元、500元、1000元）。
    *   **兑换逻辑：**
        *   小B使用1000元利润账户余额，购买面值1000元的京东E卡。
        *   **成本：** 我方平台需批量采购京东E卡，通常会有折扣（如98折）。`平台采购成本 = 1000 * 0.98 = 980元`。
        *   **交付：** 系统通过API自动向上游卡商下单，并将卡密或充值链接交付给小B。
    *   **税务处理：** 此方式在税务上被视为“采购商品/服务”，而非直接支付劳务报酬，具有税务优化空间。（*注：具体合规性需与法务和税务顾问确认*）
    *   **优势：** 小B获得等值消费力，税负感低；平台可赚取采购折扣差价。

*   **C. 平台积分/信用兑换**
    *   **产品形态：** 商城中的“平台积分”商品。
    *   **兑换逻辑：**
        *   小B可将其利润按一定比例（如`1:1.05`）兑换为平台积分。
        *   **用途：** 这些积分未来可用于：
            1.  **抵扣其自己出行的酒店订单费用。**
            2.  **作为营销工具，发放给其C端用户（如“预订满千送50积分”）。**
    *   **优势：** 将利润留在平台生态内，增加用户粘性，促进复购和二次营销。

##### **3.4 PRD功能落地方案**
*   **小B后台：**
    1.  **新增“我的钱包/利润中心”页面：**
        *   展示“可用利润余额”、“累计利润”、“待结算利润”。
        *   提供“利润明细”查询，可追溯到每一笔订单。
    2.  **新增“利润提取/兑换商城”入口：**
        *   陈列上述A、B、C三种（或更多）提取方式。
        *   清晰展示每种方式的规则、手续费/税费（如有）、预计到账时间。
*   **管理后台：**
    1.  **财务模块升级：**
        *   “结算中心”生成的不再是待付账单，而是**“利润计入批次”**。
        *   财务人员审核该批次无误后，点击“确认计入”，对应小B的利润账户余额即增加。
    2.  **新增“提取管理”模块：**
        *   展示所有小B的提取申请列表（现金、京东卡等）。
        *   财务人员在此处理现金打款，或查看卡密发放状态。
