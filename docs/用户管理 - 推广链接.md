# 推广链接管理 PRD

> 关联文档：[`系统架构图`](./系统架构图.md)、[`用户管理 - 用户列表`](./用户管理 - 用户列表.md)

## 1. 背景与目标
- 管理平台内所有用户的推广链接（SaaS大B和推广联盟小B）
- 支持推广代码的自定义、唯一性校验和冲突处理
- 实现链接的启用/禁用、推广代码重置等管理操作
- 确保链接与价格逻辑的正确关联

## 2. 范围
- 推广链接列表页面（查看、搜索、筛选、分页）
- 推广链接详情页面（链接信息、活动链接、价格关联）
- 推广链接操作功能（启用/禁用、重置推广代码、强制修改推广代码）
- 推广代码管理（唯一性校验、冲突处理、保留列表）

## 3. 角色与权限
| 角色 | 权限 | 备注 |
| --- | --- | --- |
| Admin（管理员） | 查看/搜索/筛选、进入详情、禁用/启用链接、重置推广代码、强制修改推广代码 | 仅限平台管理员 |
| BigB / SmallB 客户 | 无访问权限 | 通过各自管理端查看和管理推广链接 |

## 4. 推广链接列表（List View）

### 4.1 功能概览
- 展示所有用户的推广链接（SaaS大B和推广联盟小B）
- 支持按多维度快速检索和筛选
- 分页显示，每页20条数据

### 4.2 字段清单

| 字段 | 描述 | 取值/示例 | 备注 |
| --- | --- | --- | --- |
| 用户名称 | 商户展示名称 | `杭州慢旅酒店服务中心` | 固定左侧显示 |
| 用户信息类型 | 旅行代理 / 网络博主 / 旅游类相关应用 | `旅行代理` | 徽章形式显示 |
| 业务模式 | SaaS / 推广联盟 | `SaaS` | 徽章形式显示 |
| 推广ID | 系统生成的唯一ID | `a8x3p7q` | 用于链接URL参数 |
| 推广代码 | 用户自定义的个性化代码（可为空） | `flywithelsa` | 展示时使用等宽字体 |
| 链接状态 | 启用 / 禁用 | `启用` | 徽章形式显示 |
| 创建时间 | 链接创建时间 | `2025-10-20 15:30:00` | 展示为等宽字体 |
| 最后修改时间 | 链接最后修改时间 | `2025-10-31 09:15:00` | 展示为等宽字体 |
| 操作 | 查看详情 | — | 列表仅提供进入详情页的操作 |

### 4.3 搜索与筛选

| 能力 | 说明 |
| --- | --- |
| 搜索 | 顶部右侧提供搜索框，支持用户名称、推广代码、推广ID模糊搜索；输入后立即在前端过滤 |
| 筛选 | 通过“筛选”按钮展开面板，提供用户信息类型、业务模式、链接状态三类单选下拉；支持一键清空当前筛选 |
| 分页 | 每页20条；分页器保留当前搜索与筛选条件；支持上一页、下一页及邻近页码跳转 |

### 4.4 操作
- 查看详情：进入详情页

### 4.5 交互要求
- 列表按数据源顺序展示（当前使用模拟数据）
- 当字段缺失时显示 `-`
- 推广代码列为等宽字体展示，未设置时显示 `-`
- 链接状态使用徽章显示（启用：绿色，禁用：灰色）

## 5. 推广链接详情（Detail View）

### 5.1 基本信息区块

| 区块 | 字段 | 说明 |
| --- | --- | --- |
| 用户信息 | 用户名称、用户信息类型、业务模式、链接状态 | 使用徽章区分类型和模式 |
| 链接信息 | 用户ID、推广ID、推广代码、默认链接、主推广链接（可选） | 所有字段支持复制；链接支持一键复制与新窗口打开 |
| 活动链接列表 | 活动名称、活动参数、完整链接 | 当前无真实数据时显示占位提示 |
| 价格关联信息（小B显示） | 挂载大B名称、挂载大B ID、加价率、佣金比例 | 暂以“-”占位，后端接入后补全 |

### 5.2 操作区

- 禁用/启用链接：根据当前状态切换，前端以 toast 反馈结果（模拟）
- 重置推广代码：前端触发提醒（模拟），真实逻辑需接入接口
- 强制修改推广代码：弹出对话框，需填写新推广代码与操作原因（原因不少于10个字符）
  - 对话框内提供输入框与多行文本框
  - 当前前端仅做必填与长度校验，唯一性需后端校验



## 6. 推广代码管理

### 6.1 唯一性规则
- 推广代码全局唯一（包括SaaS大B和小B）
- 系统自动校验推广代码的唯一性
- 已使用的推广代码不能被其他用户使用
- 用户修改推广代码时，原代码释放后可被其他用户使用

### 6.2 冲突处理
- 查看推广代码冲突情况
- 处理推广代码冲突（如发现重复，可强制修改）

### 6.3 保留列表
- 设置保留的推广代码（不允许用户使用，如：admin、test、api等）
- 管理保留代码列表（新增/删除）

## 7. 链接生成与价格逻辑

### 7.1 链接生成规则
- 审核通过后，系统自动为用户生成唯一的推广ID和默认链接：`https://aigohotel.com/ref?id=[推广ID]`
- 用户可以在自己的后台设置推广代码（需通过全局唯一性校验）
- 推广代码设置后，生成主推广链接：`https://aigohotel.com/ref/[推广代码]`
- 活动链接：主推广链接 + `?campaign=[活动名称]`（用户可创建多个活动链接）

### 7.2 大B链接逻辑（SaaS/MCP模式）
- **链接归属**：`partner_id = 大B的partnerId`
- **价格计算**：使用该大B自己设置的加价率（P1 → P2）
- **订单归属**：通过该链接生成的订单，`partner_id`字段为该大B的ID

### 7.3 小B链接逻辑（推广联盟模式）
- **链接归属**：`partner_id = 小B的partnerId`，`parent_partner_id = 挂载大B的partnerId`
- **价格计算**：使用挂载大B的加价率（P1 → P2），通过`parent_partner_id`关联
- **订单归属**：通过该链接生成的订单，`partner_id`字段为该小B的ID，`parent_partner_id`字段为挂载大B的ID
- **价格变化**：小B链接价格会随着挂载大B的加价率变化而变化

### 7.4 链接使用规则
- 链接状态为"启用"时，链接可以正常使用
- 链接状态为"禁用"时，链接无法使用，访问会提示链接已失效
- 禁用链接不影响已生成的订单

### 7.5 价格变化影响
- **大B修改自己的加价率**：影响该大B自己的链接价格，以及所有挂载在该大B下的小B链接价格
- **小B无法修改加价率**：小B没有加价率设置权限，链接价格完全由挂载大B控制

## 8. 操作流程

### 8.1 禁用链接
1. 在列表或详情页点击"禁用"按钮
2. 系统更新链接状态为"禁用"
3. 禁用后该链接无法使用，访问提示链接已失效
4. 已生成的订单不受影响

### 8.2 启用链接
1. 在列表或详情页点击"启用"按钮
2. 系统更新链接状态为"启用"
3. 链接恢复可用

### 8.3 重置推广代码
1. 在详情页点击"重置推广代码"按钮
2. 当前前端展示成功提示（模拟），实际清空逻辑需接入接口

### 8.4 修改推广代码
1. 在详情页点击"强制修改推广代码"按钮
2. 打开对话框，输入新推广代码和操作原因（不少于10个字符）
3. 通过前端校验后提交，展示成功提示（模拟）
4. 唯一性校验及落库由后端接口完成（待接入）


## 9. 验证规则

### 9.1 推广代码验证
- 长度：3-20字符
- 字符：仅支持字母、数字、下划线（_）、连字符（-）
- 唯一性：全局唯一，不能与已使用或保留代码重复
- 格式：不能以数字开头

### 9.2 操作原因验证
- 修改推广代码时，操作原因必填，至少10字

